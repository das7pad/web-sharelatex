
doctype html
html(
	lang=(currentLngCode || 'en')
)
	- metadata = metadata || {}
	block vars

	head
		include ./_metadata.pug
		style [ng\:cloak], [ng-cloak], [data-ng-cloak], [x-ng-cloak], .ng-cloak, .x-ng-cloak  {display: none !important; display: none; }

		-if (typeof(gaExperiments) != "undefined")
			|!{gaExperiments}

		//- Stylesheet
		link(rel='stylesheet', href=buildCssPath(getCssThemeModifier(userSettings, brandVariation)), id="main-stylesheet")

		block _headLinks

		if settings.i18n.subdomainLang
			each subdomainDetails in settings.i18n.subdomainLang
				if !subdomainDetails.hide
					link(rel="alternate", href=getTranslationUrl(subdomainDetails), hreflang=subdomainDetails.lngCode)

		//- Scripts
		//- Google Analytics
		- if (typeof(gaToken) != "undefined")
			script(type='text/javascript').
				(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
				(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
				m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
				})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
			script(type='text/javascript').
				ga('create', '#{gaToken}', '#{settings.cookieDomain.replace(/^\./, "")}');
				ga('send', 'pageview');
			if gaOptimize === true && typeof(gaOptimizeId) != "undefined"
				script(type='text/javascript').
					ga('require', '#{gaOptimizeId}')
				//- Anti-flicker snippet
				style(type='text/css') .async-hide { opacity: 0 !important}
				script(type='text/javascript').
					(function(a,s,y,n,c,h,i,d,e){s.className+=' '+y;h.start=1*new Date;
					h.end=i=function(){s.className=s.className.replace(RegExp(' ?'+y),'')};
					(a[n]=a[n]||[]).hide=h;setTimeout(function(){i();h.end=null},c);h.timeout=c;
					})(window,document.documentElement,'async-hide','dataLayer',4000,
					{'#{gaOptimizeId}':true});

		- else
			script(type='text/javascript').
				window.ga = function() { console.log("would send to GA", arguments) };

		meta(id="ol-staticPath", content=staticPath('/'))
		meta(id="ol-csrfToken" content=csrfToken)

		block head-scripts

		meta(id="ol-sharelatex" data-json content={
				siteUrl: settings.siteUrl,
				wsUrl: settings.wsUrl,
			})
		meta(id="ol-user_id" content=getLoggedInUserId())
		meta(id="ol-ExposedSettings" data-json content=ExposedSettings)

		- if (typeof(settings.algolia) != "undefined")
			meta(id="ol-sharelatex.algolia" data-json content={
					app_id: settings.algolia.app_id,
					api_key: settings.algolia.read_only_api_key,
					indexes: settings.algolia.indexes
				})

		- if (typeof(settings.templates) != "undefined")
			meta(id="ol-sharelatex.templates" data-json content={
					user_id : settings.templates.user_id,
					cdnDomain : settings.templates.cdnDomain,
					indexName : settings.templates.indexName
				})


	body
		if(settings.recaptcha && settings.recaptcha.siteKeyV3)
			script(type="text/javascript", src="https://www.google.com/recaptcha/api.js?render="+settings.recaptcha.siteKeyV3)


		- if(typeof(suppressNavbar) == "undefined")
			include layout/navbar

		block content

		- if(typeof(suppressFooter) == "undefined")
			include layout/footer

		!= moduleIncludes("contactModal", locals)
		include sentry

		script(type="text/javascript").
			function disableCDN() {
				//- do not redirect the crawler
				if (navigator.userAgent.indexOf("Googlebot") === -1
					//- prevent loops
					&& window.location.href.indexOf("nocdn=true") === -1) {
					window.location.search += '&nocdn=true'}}

		block foot-scripts
			script(type='text/javascript', async, defer, src=buildJsPath('libraries.js'), onerror='disableCDN()')
			script(type='text/javascript', async, defer, src=buildJsPath('main.js'), onerror='disableCDN()')
